<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Manga Reader ‚Äî MiniApp</title>
    <link rel="stylesheet" href="styles.css" />
    <!-- Telegram Web Apps SDK (–±–µ–∑ –Ω–µ–≥–æ –≤–Ω—É—Ç—Ä–∏ Telegram –Ω–µ –±—É–¥–µ—Ç tg.WebApp) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
   <body>
<div class="app">
<div class="container">
<!-- Catalog -->
<section id="page-catalog" class="page active">
<h1>–ú–∞–Ω–≥–∞</h1>
<p class="subtitle">–ö–∞—Ç–∞–ª–æ–≥ –¥–µ–º–æ‚Äë—Ç–∏—Ç—É–ª–æ–≤</p>
<div id="catalogGrid" class="catalog-grid"></div>
</section>


<!-- Profile -->
<section id="page-profile" class="page">
<div class="profile-header">
<div class="avatar"></div>
<div>
<div class="profile-name">–ì–æ—Å—Ç—å</div>
<div class="subtitle">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å üëã</div>
</div>
</div>
<div class="stats">
<div class="stat"><div class="num" id="stChapters">0</div><div class="subtitle">–ì–ª–∞–≤</div></div>
<div class="stat"><div class="num" id="stFav">0</div><div class="subtitle">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div></div>
<div class="stat"><div class="num" id="stTime">0 —á</div><div class="subtitle">–í—Ä–µ–º—è</div></div>
</div>
<h2>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
<div id="favRow" class="row-scroll"></div>
</section>


<!-- Detail -->
<section id="page-detail" class="page">
<div class="detail-hero">
<img id="dCover" alt="cover" />
<div>
<div id="dTitle" class="detail-title">‚Äî</div>
<div id="dDesc" class="detail-desc">‚Äî</div>
<div class="actions">
<button id="btnRead" class="btn primary">–ß–∏—Ç–∞—Ç—å</button>
<button id="btnFav" class="btn ghost">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
</div>
</div>
</div>
<h2 style="margin-top:14px">–ì–ª–∞–≤—ã</h2>
<div id="chapters" class="chapters"></div>
</section>
</div>


<!-- TABS -->
<nav class="tabs">
<div class="inner">
<button data-tab="catalog" class="tab-btn active" aria-label="–ö–∞—Ç–∞–ª–æ–≥">
<svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6zm8 0a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V6z"/></svg>
<span>–ö–∞—Ç–∞–ª–æ–≥</span>
</button>
<button data-tab="profile" class="tab-btn" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">
<svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-5 0-9 2.5-9 5.5A1.5 1.5 0 0 0 4.5 21h15A1.5 1.5 0 0 0 21 19.5C21 16.5 17 14 12 14z"/></svg>
<span>–ü—Ä–æ—Ñ–∏–ª—å</span>
</button>
<button data-tab="favorites" class="tab-btn" aria-label="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" id="tabFav">
<svg class="icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21s-7-4.4-7-10a4.5 4.5 0 0 1 8-2.7A4.5 4.5 0 0 1 19 11c0 5.6-7 10-7 10z"/></svg>
<span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
</button>
</div>
</nav>
</div>
            <script>
// ===== THEME via Telegram WebApp =====
const tg = window.Telegram?.WebApp;
if (tg) {
tg.ready(); tg.expand();
try {
const tp = tg.themeParams || {};
if(tp.bg_color) document.documentElement.style.setProperty('--bg', tp.bg_color);
if(tp.text_color) document.documentElement.style.setProperty('--text', tp.text_color);
if(tp.button_color) document.documentElement.style.setProperty('--accent', tp.button_color);
} catch(_){}
}


// ===== DATA (demo) =====
const MANGA = [
{ id:'luna', title:'–õ—É–Ω–Ω—ã–π –≥–æ—Ä–æ–¥', desc:'–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥, –≥–¥–µ –ª—É–Ω–∞ –æ—Å–≤–µ—â–∞–µ—Ç –ø—É—Ç—å.', chapters: 12 },
{ id:'dawn', title:'–°–∞–¥—ã —Ä–∞—Å—Å–≤–µ—Ç–∞', desc:'–ò—Å—Ç–æ—Ä–∏—è –æ –ø–æ–∏—Å–∫–µ —Å–≤–µ—Ç–∞.', chapters: 9 },
{ id:'desert', title:'–ü–µ—Å–æ—á–Ω—ã–π –º–∏—Ä', desc:'–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤ –±–∞–≥—Ä–æ–≤—ã—Ö –¥—é–Ω–∞—Ö.', chapters: 14 },
{ id:'troll', title:'–ë–µ—Ä–µ–∑–æ–≤–∞—è —Ç—Ä–æ–ø–∞', desc:'–î–æ—Ä–æ–≥–∞ —á–µ—Ä–µ–∑ —Å–µ–≤–µ—Ä–Ω—ã–µ –ª–µ—Å–∞.', chapters: 8 },
{ id:'sky', title:'–û–ø–∞–ª–æ–≤–∞—è —Å–∫–∞–∑–∫–∞', desc:'–ù–µ–±–µ—Å–∞ –≤ –æ—Ç—Ç–µ–Ω–∫–∞—Ö –æ–ø–∞–ª–∞.', chapters: 6 },
{ id:'star', title:'–ó–≤–µ–∑–¥–∞ –∑–∞ —Ö–æ–ª–º–æ–º', desc:'–û–¥–Ω–∞ –∑–≤–µ–∑–¥–∞ ‚Äî —Ç—ã—Å—è—á–∞ –¥–æ—Ä–æ–≥.', chapters: 10 },
];


const qs = (s, r=document) => r.querySelector(s);
const qsa = (s, r=document) => [...r.querySelectorAll(s)];


// simple helpers for placeholder covers
const coverUrl = (title) => `https://placehold.co/600x800/png?text=${encodeURIComponent(title)}`;


// ===== STATE & STORAGE =====
const STORAGE_KEYS = { fav:'manga:fav', read:'manga:read', time:'manga:time' };
const state = {
favorites: new Set(JSON.parse(localStorage.getItem(STORAGE_KEYS.fav) || '[]')),
read: JSON.parse(localStorage.getItem(STORAGE_KEYS.read) || '{}'), // {id:[1,2]}
time: Number(localStorage.getItem(STORAGE_KEYS.time) || '0'), // hours
currentId: null,
};
const saveFav = () => localStorage.setItem(STORAGE_KEYS.fav, JSON.stringify([...state.favorites]));
const saveRead = () => localStorage.setItem(STORAGE_KEYS.read, JSON.stringify(state.read));
const saveTime = () => localStorage.setItem(STORAGE_KEYS.time, String(state.time));


// ===== RENDER CATALOG =====
function renderCatalog(){
const grid = qs('#catalogGrid');
grid.innerHTML = '';
MANGA.forEach(m => {
const card = document.createElement('div');
card.className = 'card';
card.innerHTML = `<img class="cover" loading="lazy" src="${coverUrl(m.title)}" alt="${m.title}"><div class="title">${m.title}</div>`;
card.onclick = () => openDetail(m.id);
grid.appendChild(card);
});
}


// ===== RENDER PROFILE =====
function renderProfile(){
const totalRead = Object.values(state.read).reduce((a,arr)=>a+arr.length,0);
qs('#stChapters').textContent = totalRead;
qs('#stFav').textContent = state.favorites.size;
qs('#stTime').textContent = state.time + ' —á';
const favRow = qs('#favRow');
favRow.innerHTML = '';
[...state.favorites].map(id => MANGA.find(m=>m.id===id)).filter(Boolean).forEach(m => {
const el = document.createElement('div');
el.className = 'fav-card';
el.innerHTML = `<img src="${coverUrl(m.title)}" alt="${m.title}"><div class="t">${m.title}</div>`;
el.onclick = () => openDetail(m.id);
favRow.appendChild(el);
});
}


// ===== RENDER DETAIL =====
function openDetail(id){
state.currentId = id;
const m = MANGA.find(x=>x.id===id); if(!m) return;
qs('#dCover').src = coverUrl(m.title);
qs('#dTitle').textContent = m.title;
qs('#dDesc').textContent = m.desc;
const btnFav = qs('#btnFav');
setFavButton(btnFav, state.favorites.has(id));
btnFav.onclick = () => toggleFavorite(id);


const ch = qs('#chapters'); ch.innerHTML = '';
for(let i=1;i<=m.chapters;i++){
const it = document.createElement('div');
it.className = 'ch-item';
const read = (state.read[id]||[]).includes(i);
it.innerHTML = `<div>${read ? '‚úîÔ∏è ' : ''}–ì–ª–∞–≤–∞ ${i}</div><div class="arrow">‚Ä∫</div>`;
it.onclick = () => toggleRead(id, i, it);
ch.appendChild(it);
}
goto('detail');
}


function setFavButton(btn, isFav){
btn.textContent = isFav ? '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º' : '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ';
btn.className = 'btn ' + (isFav ? 'ghost' : 'ghost');
}


function toggleFavorite(id){
if(state.favorites.has(id)) state.favorites.delete(id); else state.favorites.add(id);
saveFav();
setFavButton(qs('#btnFav'), state.favorites.has(id));
renderProfile();
}


function toggleRead(id, chapter, el){
const set = new Set(state.read[id]||[]);
if(set.has(chapter)) set.delete(chapter); else set.add(chapter);
state.read[id] = [...set];
saveRead();
// update UI & stats
if(el) el.querySelector('div').innerHTML = `${set.has(chapter)?'‚úîÔ∏è ':''}–ì–ª–∞–≤–∞ ${chapter}`;
renderProfile();
}


// ===== TABS / NAV =====
function goto(name){
qsa('.page').forEach(p=>p.classList.remove('active'));
qs(`#page-${name}`).classList.add('active');
qsa('.tab-btn').forEach(b=>b.classList.toggle('active', b.dataset.tab===name || (name==='detail' && b.dataset.tab==='catalog')));
// scroll to top of content each time
document.querySelector('.container').scrollTo({top:0,behavior:'smooth'});
}


qsa('.tab-btn').forEach(btn => btn.addEventListener('click', () => {
const t = btn.dataset.tab;
if(t==='favorites'){ // quick jump to profile favorites section
goto('profile');
qs('#favRow').scrollIntoView({behavior:'smooth',block:'start'});
} else {
goto(t);
}
}));


// ===== INIT =====
renderCatalog();
renderProfile();
</script>
    </body>

</html>

